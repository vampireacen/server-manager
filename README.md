# 服务器管理系统

## 功能特性

### 核心功能
- 🖥️ **服务器监控**: 实时监控CPU、内存、磁盘使用情况
- 📊 **图表展示**: 使用Chart.js展示监控数据和历史趋势
- 👥 **用户管理**: 支持普通用户和管理员角色
- 📋 **权限申请**: 用户可申请不同类型的服务器权限
- ✅ **审核流程**: 管理员可审核通过或拒绝申请
- 🔔 **通知提醒**: 管理员收到新申请的实时通知

### 权限类型
- 普通用户：基本SSH访问权限
- 管理员权限：sudo权限和系统管理
- Docker权限：Docker容器管理权限
- 数据库权限：数据库访问和管理权限
- 自定义权限：其他特殊权限需求

## 技术栈
- **后端**: Python + Flask + SQLite
- **前端**: HTML + Bootstrap 5 + Chart.js + jQuery
- **监控**: paramiko (SSH连接)
- **认证**: Session-based认证

## 安装部署

### 1. 环境要求
- Python 3.7+
- pip

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行应用
```bash
python app.py
```

应用将在 http://localhost:5000 启动

### 4. 默认登录
- 用户名: admin
- 密码: admin123

## 使用指南

### 管理员操作流程
1. **添加服务器**: 在"管理 → 服务器管理"中添加要监控的服务器
2. **配置权限**: 系统预设了5种权限类型，可根据需要调整
3. **审核申请**: 在"管理 → 审核申请"中处理用户的权限申请
4. **监控查看**: 在控制台实时查看所有服务器状态

### 普通用户操作流程
1. **查看服务器**: 在控制台查看可用服务器的监控状态
2. **申请权限**: 点击"申请权限"选择服务器和权限类型
3. **跟踪申请**: 在"我的申请"中查看申请状态和审核结果

### 监控功能
- **实时数据**: 每30秒自动更新监控数据
- **历史图表**: 点击服务器详情查看6小时历史趋势
- **状态指示**: 在线(绿色)、离线(红色)、未知(灰色)

## 项目结构
```
server-manage/
├── app.py              # Flask主应用
├── models.py           # 数据库模型
├── server_monitor.py   # 服务器监控逻辑
├── config.py           # 配置文件
├── requirements.txt    # Python依赖
├── database.db         # SQLite数据库(运行后生成)
├── templates/          # HTML模板
│   ├── base.html
│   ├── login.html
│   ├── dashboard.html
│   ├── apply.html
│   ├── my_applications.html
│   ├── admin_review.html
│   ├── admin_servers.html
│   └── admin_users.html
└── static/             # 静态文件目录
    ├── css/
    └── js/
```

## 数据库表结构
- **users**: 用户信息和角色
- **servers**: 服务器配置信息
- **permission_types**: 权限类型定义
- **applications**: 用户申请记录
- **server_metrics**: 服务器监控数据
- **notifications**: 管理员通知

## 配置说明

### SSH连接配置
在添加服务器时需要提供：
- 服务器名称（显示名称）
- 主机地址（IP或域名）
- SSH端口（默认22）
- 用户名
- 密码（目前仅支持密码认证）

### 监控数据收集
系统通过SSH连接执行以下命令收集监控数据：
- CPU使用率: `top -bn1` 或 `/proc/stat`
- 内存使用率: `free`
- 磁盘使用率: `df -h /`
- 系统负载: `uptime`

## 安全注意事项
1. **修改默认密码**: 部署后立即修改admin默认密码
2. **SSH密钥**: 建议使用SSH密钥而非密码认证
3. **HTTPS**: 生产环境建议配置HTTPS
4. **防火墙**: 限制应用访问来源IP
5. **定期备份**: 定期备份数据库文件

## 故障排除

### 常见问题
1. **SSH连接失败**: 检查服务器地址、端口、用户名密码是否正确
2. **监控数据为空**: 确保SSH用户有执行监控命令的权限
3. **页面无法访问**: 检查防火墙设置和端口占用

### 日志查看
应用运行时会在控制台输出日志信息，包括SSH连接状态和错误信息。

## 扩展开发
系统采用模块化设计，支持以下扩展：
- 添加新的权限类型
- 集成更多监控指标
- 支持SSH密钥认证
- 添加邮件通知功能
- 集成LDAP用户认证

## 许可证
MIT License